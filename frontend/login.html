<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mAIgnify - Login</title>

    <link rel="icon" href="assets/maignify-logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        #login-page {
            background-image: url('assets/medical-background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }
        #login-page::before {
            content: '';
            position: absolute;
            inset: 0;
            background-color: rgba(17, 24, 39, 0.85);
            z-index: 1;
        }
        .login-container {
            position: relative;
            z-index: 2;
        }
    </style>
</head>

<body>

<header class="header">
    <nav class="container navbar">
        <a href="index.html" class="logo">
            <img src="assets/maignify-logo.png" alt="mAIgnify Logo">
            <span id="logo-text">mAIgnify</span>
        </a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="features.html">Features</a></li>
            <li><a href="agents.html">Agents</a></li>
            <li><a href="about.html">About Us</a></li>
            <li id="auth-container"></li>
        </ul>
    </nav>
</header>

<main id="login-page">
    <div class="login-container">

        <h2>Login to mAIgnify</h2>

        <form id="login-form">
            <input type="email" id="email-input" placeholder="Email" required>
            <input type="password" id="password-input" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>

        <p id="error-message"></p>

        <div class="divider">or continue with</div>

        <button id="google-login-btn">Google</button>
        <button id="apple-login-btn">Apple</button>

    </div>
</main>

<footer>
    <p>&copy; 2025 mAIgnify Project</p>
</footer>

<!-- ================= FIREBASE AUTH SCRIPT ================= -->
<script type="module">

/* ========= DEVICE CHECK ========= */
const isAppleDevice = /Mac|iPhone|iPad/i.test(navigator.userAgent);
const appleBtn = document.getElementById("apple-login-btn");
if (!isAppleDevice) {
    appleBtn.disabled = true;
    appleBtn.style.opacity = "0.5";
    appleBtn.title = "Apple Login works only on Apple devices";
}

/* ========= FIREBASE IMPORTS ========= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import {
    getAuth,
    GoogleAuthProvider,
    OAuthProvider,
    signInWithRedirect,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    getRedirectResult
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

/* ========= FIREBASE CONFIG ========= */
const firebaseConfig = {
    apiKey: "AIzaSyCQ7B-0Hg1SRRaclGxmaDisnld1nFtMuG4",
    authDomain: "maistro-e93eb.firebaseapp.com",
    projectId: "maistro-e93eb",
    storageBucket: "maistro-e93eb.firebasestorage.app",
    messagingSenderId: "809190380385",
    appId: "1:809190380385:web:8d545d7595b9eef5076b20"
};

/* ========= INIT ========= */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const googleProvider = new GoogleAuthProvider();
const appleProvider = new OAuthProvider("apple.com");

/* ========= UI ========= */
const loginForm = document.getElementById("login-form");
const emailInput = document.getElementById("email-input");
const passwordInput = document.getElementById("password-input");
const errorMessage = document.getElementById("error-message");
const googleBtn = document.getElementById("google-login-btn");

/* ========= EMAIL LOGIN ========= */
loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMessage.textContent = "Logging in...";
    try {
        await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
        window.location.href = "index.html";
    } catch (err) {
        errorMessage.textContent = err.message;
    }
});

/* ========= GOOGLE LOGIN ========= */
googleBtn.addEventListener("click", async () => {
    await signInWithRedirect(auth, googleProvider);
});

/* ========= APPLE LOGIN ========= */
appleBtn.addEventListener("click", async () => {
    await signInWithRedirect(auth, appleProvider);
});

/* ========= HANDLE REDIRECT RESULT (ðŸ”¥ CRITICAL FIX) ========= */
getRedirectResult(auth)
    .then((result) => {
        if (result && result.user) {
            console.log("âœ… Login success:", result.user.email);
            window.location.href = "index.html";
        }
    })
    .catch((error) => {
        console.error("âŒ Redirect error:", error);
        errorMessage.textContent = "Login failed. Please try again.";
    });

/* ========= AUTH STATE ========= */
onAuthStateChanged(auth, (user) => {
    if (user) {
        console.log("User logged in:", user.email);
    }
});

</script>
</body>
</html>
